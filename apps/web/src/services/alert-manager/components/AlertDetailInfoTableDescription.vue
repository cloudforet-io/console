<template>
    <p v-if="!isEditMode"
       class="content-wrapper"
    >
        <p-collapsible-panel :line-clamp="10">
            <p-text-beautifier class="description"
                               :value="alertData.description"
            />&zwnj;
        </p-collapsible-panel>
        <button class="edit-btn"
                :class="{'disabled': manageDisabled}"
                @click="startEdit(alertData.description)"
        >
            {{ $t('IDENTITY.USER.NOTIFICATION.EDIT') }}
        </button>
    </p>
    <div v-else
         class="content-wrapper"
    >
        <p-textarea v-model="dataForUpdate"
                    class="textarea"
        />
        <div class="button-group">
            <p-button style-type="secondary"
                      class="text-button"
                      size="sm"
                      @click="cancelEdit(alertData.description)"
            >
                {{ $t('MONITORING.ALERT.DETAIL.INFO.CANCEL') }}
            </p-button>
            <p-button
                style-type="primary"
                size="sm"
                class="text-button"
                @click="onClickSave(EDIT_MODE.DESCRIPTION)"
            >
                {{ $t('MONITORING.ALERT.DETAIL.INFO.SAVE_CHANGES') }}
            </p-button>
        </div>
    </div>
</template>

<script lang="ts">
import { toRefs } from 'vue';

import {
    PTextarea, PButton, PTextBeautifier, PCollapsiblePanel,
} from '@spaceone/design-system';

import { useAlertInfoItem } from '@/services/alert-manager/composables/alert-info';
import { EDIT_MODE } from '@/services/alert-manager/constants/alert-constant';

export default {
    name: 'AlertDetailInfoTableDescription',
    components: {
        PTextarea,
        PButton,
        PTextBeautifier,
        PCollapsiblePanel,
    },
    props: {
        id: {
            type: String,
            default: undefined,
        },
        alertData: {
            type: Object,
            default: () => ({}),
        },
        manageDisabled: {
            type: Boolean,
            default: false,
        },
    },
    setup(props) {
        const {
            state: alertDetailItemState,
            cancelEdit,
            startEdit,
            onClickSave,
        } = useAlertInfoItem({
            alertId: props.id,
            isEditMode: false,
            dataForUpdate: props.alertData?.description,
        });
        return {
            EDIT_MODE,
            ...toRefs(alertDetailItemState),
            cancelEdit,
            startEdit,
            onClickSave,
        };
    },
};
</script>

<style lang="postcss" scoped>
@import './styles/alertInfoItem.pcss';
.description {
    white-space: pre-wrap;
}
.textarea {
    min-height: 15rem;
}
.edit-btn {
    &.disabled {
        @apply cursor-not-allowed text-gray-400;
    }
    &.disabled:active {
        pointer-events: none;
    }
}
</style>
